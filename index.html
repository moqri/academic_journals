<html>
<head>
<script language="JavaScript" type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.0/jquery.min.js"></script>

</head>
<body>
	<form>
		<label><b>Journal Name</b></label>
		<input type="text" name="message" id="user_input" 
	</form>

  	<input type="submit" onclick="find_journals();"><br/>

	<h3>Journals</h3>
	<table id="journals_table">
	    <thead>
	        <tr>
	            <td>Title</td>
	            <td>Publisher</td>
	            <td>ISSN</td>
	        </tr>	        
	    </thead>
	    <tbody>
	    </tbody>
	</table>

<script>
$(document).ready(function() {
  $(window).keydown(function(event){
    if(event.keyCode == 13) {
      event.preventDefault();
      return false;
    }
  });
});
$("#user_input").on('change keyup paste', find_journals);
	function find_journals(){
	endpoint='http://brdb.warrington.ufl.edu:3030/test/query';
	search=document.getElementById("user_input").value;
	filter=' filter(regex(lcase(?t),"'+search+'")) ';
	limit='limit 100';
	query='select DISTINCT * where { '+
	'?s <e:title> ?t;'+
	'<e:publisher> ?p;'+
	'<e:issn> ?i;'+
	'<e:count> ?docs;'+
	'<e:cited> ?cited;'+
	'<e:citation> ?citation;'+
	'<e:impact> ?impact;'+
	'<e:h> ?h;'+
	filter+ 
	'}' + limit 
	url=endpoint+'?query='+query
		return $.ajax({
		  	url: url,
		  	method: 'GET'
		}).then(function(data) {
			journals=data['results']['bindings'];
			document.getElementById('journals_table').innerHTML='';
			journals.forEach(function(journal){
				title=journal['t']['value'];
				publisher=journal['p']['value'];
				issn=journal['i']['value'];		
				docs=journal['docs']['value'];		
				cited=journal['cited']['value'];		
				citation=journal['citation']['value'];		
				impact=journal['impact']['value'];		
				h=journal['h']['value'];		
				issn=journal['i']['value'];		
						
				document.getElementById('journals_table').innerHTML += '<tr>\
				<td>'+title+'</td>\
				<td>'+publisher+'</td>\
				<td><a href=journal.html?issn='+issn+' target="_blank">'+issn+'</td>\
				<td>'+docs+'</td>\
				<td>'+cited+'</td>\
				<td>'+citation+'</td>\
				<td>'+impact+'</td>\
				<td>'+h+'</td>\
				<td>'
			});
		});
	};
</script>
</body>
</html>