<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Scholarly Journals Database</title>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">
    <link rel = "stylesheet" type = "text/css" href = "css/style.css">
  </head>
  <body>

    <nav class="navbar navbar-inverse navbar-fixed-top">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false" aria-controls="navbar">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
        </div>
        <div id="navbar" class="collapse navbar-collapse">
          <ul class="nav navbar-nav">
            <li class="active"><a href="index.html">Home</a></li>
            <li><a href="mailto:moqri@ufl.edu">Contact</a></li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </nav>
    <div class="container">	
		<br></br>
		<br></br>
		<div align="center" class="starter-template"><h1>Scholarly Journals Database</h1><h5>Based on <a href="https://www.crossref.org/" target="_blank">Crossref</a> data & publication years 2014 to 2016</h4>
		<h5>50,100 Journals - 9 Million Articles - 36 Million Citations (August 2017)</h5>
		</div>
		<br>

		<select id="subject_category">
		  	<option selected value="base">Please Select</option>
			<option value="Agricultural and Biological Sciences">Agricultural and Biological Sciences</option>
			<option value="Arts and Humanities">Arts and Humanities</option>
			<option value="Biochemistry, Genetics and Molecular Biology">Biochemistry, Genetics and Molecular Biology</option>
			<option value="Business, Management and Accounting">Business, Management and Accounting</option>
			<option value="Chemical Engineering">Chemical Engineering</option>
			<option value="Chemistry">Chemistry</option>
			<option value="Computer Science">Computer Science</option>
			<option value="Decision Sciences">Decision Sciences</option>
			<option value="Dentistry">Dentistry</option>
			<option value="Earth and Planetary Sciences">Earth and Planetary Sciences</option>
			<option value="Economics, Econometrics and Finance">Economics, Econometrics and Finance</option>
			<option value="Energy">Energy</option>
			<option value="Engineering">Engineering</option>
			<option value="Environmental Science">Environmental Science</option>
			<option value="General">General</option>
			<option value="Health Professions">Health Professions</option>
			<option value="Immunology and Microbiology">Immunology and Microbiology</option>
			<option value="Materials Science">Materials Science</option>
			<option value="Mathematics">Mathematics</option>
			<option value="Medicine">Medicine</option>
			<option value="Neuroscience">Neuroscience</option>
			<option value="Nursing">Nursing</option>
			<option value="Pharmacology, Toxicology and Pharmaceutics">Pharmacology, Toxicology and Pharmaceutics</option>
			<option value="Physics and Astronomy">Physics and Astronomy</option>
			<option value="Psychology">Psychology</option>
			<option value="Social Sciences">Social Sciences</option>
			<option value="veterinary">veterinary</option>
		</select>

		<br>

		<select id="category">
		  <option>Please choose from above</option>
		</select>

		  <div class="form-group">	
			<label><b>Search Journal Name</b></label>
			<input class="form-control" type="text" id="user_input"> 
		  </div>			
			<input class="btn btn-default" type="submit" onclick="find_journals(0);">
		<br></br>

		<h3>Journals</h3>
		<table class="table">
			<thead>
				<tr>
					<th>Title</th>
					<th>Publisher</th>
					<th>Citable Documents</th>
					<th>Total Citations</th>
					<th>Citations/Documents</th>
					<th>h3 Index</th>
				</tr>	        
			</thead>
			<tbody id="journals_table">
			</tbody>
		</table>
		<div class="loader"></div>
		<button id="load_more" class="btn btn-link" type="submit" onclick="find_journals(offset_global);">Load more (click and wait)</button>

	<footer>
	  <br>
	  <p></p>
	</footer>
	</div>

	<script>
	$(document).ready(function() {

$("#subject_category").change(function() {

	var $dropdown = $(this);

	$.getJSON("cats.json", function(data) {

		var key = $dropdown.val();
		var vals = [];
							
		switch(key) {
			case "Agricultural and Biological Sciences":
				vals = data["Agricultural and Biological Sciences"].split(";");
				break;
			case "Arts and Humanities":
				vals = data["Arts and Humanities"].split(";");
				break;
			case "Biochemistry, Genetics and Molecular Biology":
				vals = data["Biochemistry, Genetics and Molecular Biology"].split(";");
				break;
			case "Business, Management and Accounting":
				vals = data["Business, Management and Accounting"].split(";");
				break;
			case "Chemical Engineering":
				vals = data["Chemical Engineering"].split(";");
				break;
			case "Chemistry":
				vals = data["Chemistry"].split(";");
				break;
			case "Computer Science":
				vals = data["Computer Science"].split(";");
				break;
			case "Decision Sciences":
				vals = data["Decision Sciences"].split(";");
				break;
			case "Dentistry":
				vals = data["Dentistry"].split(";");
				break;
			case "Earth and Planetary Sciences":
				vals = data["Earth and Planetary Sciences"].split(";");
				break;
			case "Economics, Econometrics and Finance":
				vals = data["Economics, Econometrics and Finance"].split(";");
				break;
			case "Energy":
				vals = data["Energy"].split(";");
				break;
			case "Engineering":
				vals = data["Engineering"].split(";");
				break;
			case "Environmental Science":
				vals = data["Environmental Science"].split(";");
				break;
			case "General":
				vals = data["General"].split(";");
				break;
			case "Health Professions":
				vals = data["Health Professions"].split(";");
				break;
			case "Immunology and Microbiology":
				vals = data["Immunology and Microbiology"].split(";");
				break;
			case "Materials Science":
				vals = data["Materials Science"].split(";");
				break;
			case "Mathematics":
				vals = data["Mathematics"].split(";");
				break;
			case "Medicine":
				vals = data["Medicine"].split(";");
				break;
			case "Neuroscience":
				vals = data["Neuroscience"].split(";");
				break;
			case "Nursing":
				vals = data["Nursing"].split(";");
				break;
			case "Pharmacology, Toxicology and Pharmaceutics":
				vals = data["Pharmacology, Toxicology and Pharmaceutics"].split(";");
				break;
			case "Physics and Astronomy":
				vals = data["Physics and Astronomy"].split(";");
				break;
			case "Psychology":
				vals = data["Psychology"].split(";");
				break;
			case "Social Sciences":
				vals = data["Social Sciences"].split(";");
				break;
			case "veterinary":
				vals = data["veterinary"].split(";");
				break;
			case 'base':
				vals = ['Please choose from above'];
		}
		
		var $secondChoice = $("#category");
		$secondChoice.empty();
		$.each(vals, function(index, value) {
			$secondChoice.append("<option>" + value + "</option>");
		});

	});
});

		find_journals(0)
		$('#user_input').keypress(function(e){
		  if(e.keyCode==13)
		  find_journals(0);
		});	
		offset_global=20
	});
	//$("#user_input").on('change keyup paste', find_journals);
	function find_journals(offset){
	offset_global=offset+20
	endpoint='http://brdb.warrington.ufl.edu:3030/test14/query';
	search=document.getElementById("user_input").value.toLowerCase();
	filter=' filter(regex(lcase(?title),"'+search+'")) ';
	subject=$("#category").find(":selected").text();
	if (subject!='Please choose from above'){
		filter="<e:subjects> '"+subject+"' " + filter
	}

	console.log(subject)
	limit='limit 20';
	var query = [
	 "PREFIX xsd: <http://www.w3.org/2001/XMLSchema#>",
	 "select DISTINCT ?s ?title ?docs ?citation (xsd:decimal(?impact_) AS ?impact) ?h ?publisher",
	 "WHERE {",
		"?s <e:title> ?title;",
		"<e:publisher> ?publisher;",
		"<e:count> ?docs;",
		"<e:citation> ?citation;",
		"<e:impact> ?impact_;",
		"<e:h> ?h;",
		filter,
	 "}",
	 "ORDER BY DESC(?h)",
	 limit,
	 'OFFSET '+ offset.toString()
	].join(" ");	
	console.log(query)
		url=endpoint+'?query='+encodeURIComponent(query) +"&format=json";
			return $.ajax({
				url: url,
				method: 'GET'
			}).then(function(data) {
				journals=data['results']['bindings'];
				if (offset==0){ document.getElementById('journals_table').innerHTML=''}
				journals.forEach(function(journal){
					if ('title' in journal){
						title=journal['title']['value'];
					}
					publisher=journal['publisher']['value'];
					issn=journal['s']['value'].slice(-9);		
					docs=journal['docs']['value'];		
					citation=journal['citation']['value'];		
					impact=journal['impact']['value'];		
					h=journal['h']['value'];		
							
					document.getElementById('journals_table').innerHTML += '<tr>\
					<td><a href=journal.html?issn='+issn+
					'&title='+encodeURIComponent(title)+
					'&publisher='+encodeURIComponent(publisher)+
					' target="_blank">'+title+'</td>\
					<td>'+publisher+'</td>\
					<td>'+docs+'</td>\
					<td>'+citation+'</td>\
					<td>'+impact+'</td>\
					<td>'+h+'</td>\
					</tr>'			
				});
			$(".loader").hide();
			});
		};

		</script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
  </body>
</html>